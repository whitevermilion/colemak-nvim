return {
  "mfussenegger/nvim-dap",
  ft = { "cpp", "cxx", "cc" },  -- 支持多种 C++ 文件扩展名
  config = function()
    local dap = require("dap")
    
    -- C++ 语言专用调试配置
    dap.configurations.cpp = {
      {
        name = "Launch C++ (Debug)",
        type = "codelldb",
        request = "launch",
        program = function()
          return vim.fn.input("Path to executable: ", vim.fn.getcwd() .. "/", "file")
        end,
        cwd = "${workspaceFolder}",
        stopOnEntry = false,
        runInTerminal = true,
        args = {},
        setupCommands = {
          {
            description = "Enable pretty-printing for gdb",
            text = "-enable-pretty-printing",
            ignoreFailures = false
          }
        },
      },
      {
        name = "Launch C++ (With Args)",
        type = "codelldb",
        request = "launch",
        program = function()
          return vim.fn.input("Path to executable: ", vim.fn.getcwd() .. "/", "file")
        end,
        args = function()
          local args_string = vim.fn.input("Program arguments: ")
          return vim.split(args_string, " ")
        end,
        cwd = "${workspaceFolder}",
        stopOnEntry = false,
        runInTerminal = true,
      },
      {
        name = "Launch C++ (CMake Build)",
        type = "codelldb",
        request = "launch",
        program = function()
          -- 假设 CMake 构建在 build/ 目录
          local candidates = {
            "./build/${workspaceFolderBasename}",
            "./build/debug/${workspaceFolderBasename}",
            "./build/Release/${workspaceFolderBasename}",
            "./${workspaceFolderBasename}"
          }
          
          for _, candidate in ipairs(candidates) do
            if vim.fn.filereadable(candidate) == 1 then
              return candidate
            end
          end
          
          return vim.fn.input("Path to executable: ", vim.fn.getcwd() .. "/", "file")
        end,
        cwd = "${workspaceFolder}",
        stopOnEntry = false,
        runInTerminal = true,
        args = {},
      },
      {
        name = "Attach to C++ Process",
        type = "codelldb",
        request = "attach",
        pid = function()
          return tonumber(vim.fn.input("Process ID: "))
        end,
      }
    }
    
    -- 共享配置给 C 语言（如果需要）
    dap.configurations.c = dap.configurations.cpp
  end
}
